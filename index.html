<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0d9488" />
  <title>‚è≥ Timer</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #83a4d4, #b6fbff);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      background-color: #ffffffcc;
      backdrop-filter: blur(8px);
      padding: 30px 20px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }

    h2 {
      margin-top: 0;
      font-size: 1.4rem;
    }

    .timer {
      font-size: 2.5rem;
      margin: 20px 0;
      color: #0d9488;
    }

    input[type="text"], input[type="datetime-local"] {
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      margin: 8px 0;
      padding: 10px;
      width: 100%;
      font-size: 1em;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s ease;
      background: linear-gradient(90deg, #0d9488, #2dd4bf);
      color: white;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }

    button:hover {
      background: linear-gradient(90deg, #0f766e, #14b8a6);
    }

    #progressBar {
      height: 10px;
      background: #0d9488;
      width: 0%;
      margin: 1rem 0;
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    #message {
      font-weight: bold;
      margin-top: 10px;
      color: #dc2626;
    }

    @media (max-width: 480px) {
      .timer {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="goalTitle">üéØ Cel: (brak)</h2>
    <input type="text" id="goalInput" placeholder="Wpisz cel..." />
    <div class="timer" id="countdown">‚è≥ Wybierz czas</div>
    <div id="progressBar"></div>
    <input type="datetime-local" id="startTime" />
    <input type="datetime-local" id="endTime" />
    <button onclick="setTimes()">Ustaw czas</button>
    <button onclick="setEndNow()">Koniec</button>
    <button onclick="toggleSound()" id="soundToggle">üîä D≈∫wiƒôk</button>
    <div id="message"></div>
    <audio id="successSound" src="https://www.soundjay.com/human/sounds/applause-8.mp3" preload="auto"></audio>
  </div>

  <script>
    let interval, soundOn = true, start, end;
    const countdownEl = document.getElementById("countdown");
    const messageEl = document.getElementById("message");
    const progressBar = document.getElementById("progressBar");
    const goalTitle = document.getElementById("goalTitle");

    function setTimes() {
      start = new Date(document.getElementById("startTime").value);
      end = new Date(document.getElementById("endTime").value);
      localStorage.setItem("start", start);
      localStorage.setItem("end", end);
      updateCountdown();
      messageEl.textContent = "‚è± Odliczanie trwa...";
    }

    function setEndNow() {
      start = new Date(localStorage.getItem("start") || new Date());
      end = new Date(Date.now() + 5000);
      localStorage.setItem("end", end);
      updateCountdown();
      messageEl.textContent = "‚è≠Ô∏è Odliczanie zako≈Ñczy siƒô za 5 sekund!";
    }

    function toggleSound() {
      soundOn = !soundOn;
      document.getElementById("soundToggle").textContent = soundOn ? 'üîä D≈∫wiƒôk' : 'üîá Wyciszony';
    }

    function playSound() {
      if (soundOn) {
        const s = document.getElementById("successSound");
        s.currentTime = 0;
        s.play().catch(() => {});
      }
    }

    function updateCountdown() {
      clearInterval(interval);
      interval = setInterval(() => {
        const now = new Date();
        const total = end - start;
        const remaining = end - now;

        if (remaining <= 0) {
          clearInterval(interval);
          countdownEl.textContent = "üõë Odliczanie zako≈Ñczone.";
          messageEl.textContent = "üéâ Gratulacje!";
          document.title = "‚è∞ Koniec - " + goalTitle.textContent;
          playSound();
          return;
        }

        const hours = String(Math.floor((remaining / (1000 * 60 * 60)))).padStart(2, '0');
        const minutes = String(Math.floor((remaining / (1000 * 60)) % 60)).padStart(2, '0');
        const seconds = String(Math.floor((remaining / 1000) % 60)).padStart(2, '0');

        countdownEl.textContent = `‚è≥ ${hours}:${minutes}:${seconds}`;
        document.title = `‚è± ${hours}:${minutes}:${seconds} - ${goalTitle.textContent}`;
        const progress = ((now - start) / total) * 100;
        progressBar.style.width = `${Math.min(progress, 100)}%`;
      }, 500);
    }

    document.getElementById("goalInput").addEventListener("input", e => {
      const val = e.target.value.trim();
      goalTitle.textContent = val ? `üéØ Cel: ${val}` : "üéØ Cel: (brak)";
      localStorage.setItem("goal", val);
    });

    window.addEventListener("load", () => {
      const savedStart = localStorage.getItem("start");
      const savedEnd = localStorage.getItem("end");
      const savedGoal = localStorage.getItem("goal");
      if (savedStart && savedEnd) {
        start = new Date(savedStart);
        end = new Date(savedEnd);
        document.getElementById("startTime").value = start.toISOString().slice(0,16);
        document.getElementById("endTime").value = end.toISOString().slice(0,16);
        updateCountdown();
      }
      if (savedGoal) {
        goalTitle.textContent = `üéØ Cel: ${savedGoal}`;
        document.getElementById("goalInput").value = savedGoal;
      }
    });
  </script>
</body>
</html>
