<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0d9488" />
  <title>‚è≥ Timer</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(135deg, #ecfeff, #ccfbf1);
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    .timer {
      font-size: 3rem;
      margin: 1rem 0;
    }
    .goal {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: #0f766e;
    }
    input, button {
      margin: 0.5rem 0;
      padding: 0.5rem;
      width: 100%;
      font-size: 1rem;
    }
    #progressBar {
      height: 10px;
      background: #0d9488;
      width: 0%;
      border-radius: 5px;
      margin: 1rem 0;
      transition: width 0.3s ease;
    }
    .muted {
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="goalTitle">üéØ Cel: (brak)</h2>
    <input type="text" id="goalInput" placeholder="Wpisz cel..." />
    <div class="timer" id="countdown">‚è≥ Wybierz czas</div>
    <div id="progressBar"></div>
    <input type="datetime-local" id="startTime" />
    <input type="datetime-local" id="endTime" />
    <button onclick="setTimes()">Ustaw czas</button>
    <button onclick="setEndNow()">Koniec</button>
    <button onclick="toggleSound()" id="soundToggle"><i class="fa-solid fa-volume-high"></i> D≈∫wiƒôk</button>
    <div id="message"></div>
    <audio id="successSound" src="https://www.soundjay.com/human/sounds/applause-8.mp3" preload="auto"></audio>
  </div>
  <script>
    let interval, soundOn = true, start, end;

    const countdownEl = document.getElementById("countdown");
    const messageEl = document.getElementById("message");
    const progressBar = document.getElementById("progressBar");
    const goalTitle = document.getElementById("goalTitle");

    function setTimes() {
      start = new Date(document.getElementById("startTime").value);
      end = new Date(document.getElementById("endTime").value);
      localStorage.setItem("start", start);
      localStorage.setItem("end", end);
      updateCountdown();
      messageEl.textContent = "‚è± Odliczanie trwa...";
    }

    function setEndNow() {
      start = new Date(localStorage.getItem("start"));
      end = new Date(Date.now() + 5000);
      localStorage.setItem("end", end);
      messageEl.textContent = "‚è≠Ô∏è Odliczanie zako≈Ñczy siƒô za 5 sekund!";
    }

    function toggleSound() {
      soundOn = !soundOn;
      document.getElementById("soundToggle").innerHTML = soundOn ?
        '<i class="fa-solid fa-volume-high"></i> D≈∫wiƒôk' :
        '<i class="fa-solid fa-volume-xmark"></i> Wyciszony';
    }

    function playSound() {
      if (soundOn) {
        const s = document.getElementById("successSound");
        s.currentTime = 0;
        s.play().catch(() => {});
      }
    }

    function updateCountdown() {
      clearInterval(interval);
      interval = setInterval(() => {
        const now = new Date();
        const total = end - start;
        const remaining = end - now;

        if (remaining <= 0) {
          clearInterval(interval);
          countdownEl.textContent = "üõë Odliczanie zako≈Ñczone.";
          messageEl.textContent = "üéâ Gratulacje!";
          document.title = "‚è∞ Koniec - " + goalTitle.textContent;
          playSound();
          return;
        }

        const hours = String(Math.floor((remaining / (1000 * 60 * 60)))).padStart(2, '0');
        const minutes = String(Math.floor((remaining / (1000 * 60)) % 60)).padStart(2, '0');
        const seconds = String(Math.floor((remaining / 1000) % 60)).padStart(2, '0');

        countdownEl.textContent = `‚è≥ ${hours}:${minutes}:${seconds}`;
        document.title = `‚è± ${hours}:${minutes}:${seconds} - ${goalTitle.textContent}`;

        const progress = ((now - start) / total) * 100;
        progressBar.style.width = `${progress}%`;
      }, 500);
    }

    document.getElementById("goalInput").addEventListener("input", e => {
      const val = e.target.value.trim();
      goalTitle.textContent = val ? `üéØ Cel: ${val}` : "üéØ Cel: (brak)";
      localStorage.setItem("goal", val);
    });

    window.addEventListener("load", () => {
      const savedStart = localStorage.getItem("start");
      const savedEnd = localStorage.getItem("end");
      const savedGoal = localStorage.getItem("goal");
      if (savedStart && savedEnd) {
        start = new Date(savedStart);
        end = new Date(savedEnd);
        document.getElementById("startTime").value = start.toISOString().slice(0,16);
        document.getElementById("endTime").value = end.toISOString().slice(0,16);
        updateCountdown();
      }
      if (savedGoal) {
        goalTitle.textContent = `üéØ Cel: ${savedGoal}`;
        document.getElementById("goalInput").value = savedGoal;
      }
    });
  </script>
</body>
</html>
